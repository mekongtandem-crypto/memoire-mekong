<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêò M√©moire du M√©kong V0.4.5 - Debug GoogleSync</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
	<script src="https://accounts.google.com/gsi/client"></script>
	<script>
	window.onload = () => {
  		google.accounts.id.initialize({
    		client_id: '82966045106-hso0nr386agcuojllnud0dr41vcsh45a.apps.googleusercontent.com'
  		});
		};
	</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .lucide { width: 1em; height: 1em; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">// ===== ICONS LUCIDE =====
        const Home = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>;
        const Users = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="m22 21-2-2"/></svg>;
        const User = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Play = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><polygon points="5,3 19,12 5,21"/></svg>;
        const Camera = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>;
        const Cloud = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>;
        const Settings = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M12.22 2h-.44a2 2 0 0 0-2 2.18l.2 1.81c-.26.06-.51.14-.76.23l-1.5-1.16a2 2 0 0 0-2.83.32l-.22.38a2 2 0 0 0 .32 2.83l1.16 1.5c-.09.25-.17.5-.23.76l-1.81.2a2 2 0 0 0-2.18 2v.44a2 2 0 0 0 2.18 2l1.81.2c.06.26.14.51.23.76l-1.16 1.5a2 2 0 0 0-.32 2.83l.38.22a2 2 0 0 0 2.83-.32l1.5-1.16c.25.09.5.17.76.23l.2 1.81a2 2 0 0 0 2 2.18h.44a2 2 0 0 0 2-2.18l.2-1.81c.26-.06.51-.14.76-.23l1.5 1.16a2 2 0 0 0 2.83-.32l.22-.38a2 2 0 0 0-.32-2.83l-1.16-1.5c.09-.25.17-.5.23-.76l1.81-.2a2 2 0 0 0 2.18-2v-.44a2 2 0 0 0-2.18-2l-1.81-.2c-.06-.26-.14-.51-.23-.76l1.16-1.5a2 2 0 0 0 .32-2.83l-.38-.22a2 2 0 0 0-2.83.32l-1.5 1.16c-.25-.09-.5-.17-.76-.23l-.2-1.81a2 2 0 0 0-2-2.18Z"/><circle cx="12" cy="12" r="3"/></svg>;
        const ChevronLeft = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>;
        const ChevronRight = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg>;
        const Clock = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>;
        const Mic = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/><line x1="8" x2="16" y1="22" y2="22"/></svg>;
        const Zap = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/></svg>;
        const MapPin = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>;
        const BookOpen = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const Edit = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5Z"/></svg>;
        const Plus = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const Shuffle = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><polyline points="16,3 21,3 21,8"/><line x1="4" x2="21" y1="20" y2="3"/><polyline points="21,16 21,21 16,21"/><line x1="15" x2="21" y1="15" y2="21"/><line x1="4" x2="9" y1="4" y2="9"/></svg>;
        const Pause = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/></svg>;
        const ArrowLeft = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>;
        const Send = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>;
        const Trash2 = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="m8 6V4c0-1 1-2 2-2h4c0-1-1-2-2-2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
        const Search = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>;
        const Upload = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,5 17,10"/><line x1="12" x2="12" y1="5" y2="15"/></svg>;
        const FileText = ({ className = "" }) => <svg className={`lucide ${className}`} viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14,2 14,8 20,8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>;

        // ===== CONFIGURATION =====
        const GOOGLE_CONFIG = {
            CLIENT_ID: '82966045106-hso0nr386agcuojllnud0dr41vcsh45a.apps.googleusercontent.com',
            SCOPES: 'https://www.googleapis.com/auth/drive'
        };

        // ===== MODULES DE DONN√âES =====
        const Storage = {
            get: (key, defaultValue = null) => { try { const item = localStorage.getItem(`mekong_${key}`); return item ? JSON.parse(item) : defaultValue; } catch { return defaultValue; } },
            set: (key, value) => { try { localStorage.setItem(`mekong_${key}`, JSON.stringify(value)); return true; } catch { return false; } },
            remove: (key) => localStorage.removeItem(`mekong_${key}`),
            clear: () => Object.keys(localStorage).forEach(key => key.startsWith('mekong_') && localStorage.removeItem(key))
        };

        const MastodonData = { /* ... Contenu de MastodonData ... */ };
        
        // ===== API GOOGLE DRIVE (SIMPLIFI√âE AVEC FETCH) =====
        const GoogleDriveAPI = {
            accessToken: null,

            async findMekongFile() {
                if (!this.accessToken) return null;
                try {
                    const query = encodeURIComponent("name='mekong_sessions.json' and 'root' in parents and trashed=false");
                    const response = await fetch(`https://www.googleapis.com/drive/v3/files?q=${query}&fields=files(id,name)`, {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    if (!response.ok) throw new Error(`Erreur HTTP: ${response.status}`);
                    const data = await response.json();
                    return data.files[0] || null;
                } catch (error) {
                    console.error('‚ùå Erreur recherche fichier:', error);
                    return null;
                }
            },
            
            async saveSessions(sessions) {
                if (!this.accessToken) return false;
                try {
                    const fileContent = JSON.stringify({ sessions, lastUpdated: new Date().toISOString() });
                    let file = await this.findMekongFile();

                    if (!file) {
                        console.log("Fichier non trouv√©, tentative de cr√©ation...");
                        const metadata = { name: 'mekong_sessions.json', parents: ['root'], mimeType: 'application/json' };
                        const createResponse = await fetch('https://www.googleapis.com/drive/v3/files', {
                            method: 'POST',
                            headers: { 'Authorization': `Bearer ${this.accessToken}`, 'Content-Type': 'application/json' },
                            body: JSON.stringify(metadata)
                        });
                        if (!createResponse.ok) {
                            const errorBody = await createResponse.text();
                            throw new Error(`Erreur cr√©ation m√©tadonn√©es: ${createResponse.status} - ${errorBody}`);
                        }
                        file = await createResponse.json();
                        console.log(`‚úÖ Fichier vide cr√©√© (ID: ${file.id})`);
                    }

                    const updateResponse = await fetch(`https://www.googleapis.com/upload/drive/v3/files/${file.id}?uploadType=media`, {
                        method: 'PATCH',
                        headers: { 'Authorization': `Bearer ${this.accessToken}`, 'Content-Type': 'application/json' },
                        body: fileContent
                    });
                    if (!updateResponse.ok) {
                        const errorBody = await updateResponse.text();
                        throw new Error(`Erreur mise √† jour contenu: ${updateResponse.status} - ${errorBody}`);
                    }
                    console.log('‚úÖ Contenu sauvegard√© sur le Drive.');
                    return true;
                } catch (error) {
                    console.error('‚ùå Erreur sauvegarde:', error);
                    return false;
                }
            },
            
            async loadSessions() {
                if (!this.accessToken) return null;
                try {
                    const file = await this.findMekongFile();
                    if (!file) {
                        console.log("Aucun fichier de session trouv√©.");
                        return null;
                    }
                    const response = await fetch(`https://www.googleapis.com/drive/v3/files/${file.id}?alt=media`, {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    if (!response.ok) throw new Error(`Erreur HTTP chargement: ${response.status}`);
                    const data = await response.json();
                    console.log('‚úÖ Sessions charg√©es depuis le Drive.');
                    return data.sessions || [];
                } catch (error) {
                    console.error('‚ùå Erreur chargement:', error);
                    return null;
                }
            }
        };

        // ===== HOOKS REACT =====
        const useAppState = () => { /* ... Contenu de useAppState ... */ };
        const useSessionState = () => { /* ... Contenu de useSessionState ... */ };
        
        const useGoogleAuth = () => {
            const [isConnected, setIsConnected] = React.useState(false);
            const [isLoading, setIsLoading] = React.useState(true);
            const [userInfo, setUserInfo] = React.useState(null);
            const [tokenClient, setTokenClient] = React.useState(null);

            React.useEffect(() => {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CONFIG.CLIENT_ID,
                    scope: GOOGLE_CONFIG.SCOPES,
                    callback: async (tokenResponse) => {
                        if (tokenResponse.error) {
                            console.error("Erreur d'authentification:", tokenResponse.error);
                            setIsConnected(false);
                            return;
                        }
                        try {
                            GoogleDriveAPI.accessToken = tokenResponse.access_token;
                            const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                                headers: { 'Authorization': `Bearer ${tokenResponse.access_token}` }
                            });
                            if (!response.ok) throw new Error('Impossible de r√©cup√©rer les infos utilisateur.');
                            const profile = await response.json();
                            setUserInfo({ name: profile.name, email: profile.email, picture: profile.picture });
                            setIsConnected(true);
                            console.log("‚úÖ Connexion r√©ussie.");
                        } catch (error) {
                            console.error("‚ùå Erreur post-connexion:", error);
                            setIsConnected(false);
                        } finally {
                            setIsLoading(false);
                        }
                    },
                });
                setTokenClient(client);
                setIsLoading(false);
            }, []);

            const signIn = () => {
                if (tokenClient) {
                    setIsLoading(true);
                    tokenClient.requestAccessToken({ prompt: 'consent' });
                }
            };

            const signOut = () => {
                GoogleDriveAPI.accessToken = null;
                setIsConnected(false);
                setUserInfo(null);
            };

            return { isConnected, isLoading, userInfo, signIn, signOut };
        };

        // ===== COMPOSANTS UI =====
        const Navigation = ({...}) => { /* ... JSX ... */ };
        const GoogleConnection = ({...}) => { /* ... JSX ... */ };
        const HomePage = ({...}) => { /* ... JSX ... */ };
        const GamesPage = ({...}) => { /* ... JSX ... */ };
        const SessionsPage = ({...}) => { /* ... JSX ... */ };
        const ChatPage = ({...}) => { /* ... JSX ... */ };
        const MemoriesPage = ({...}) => { /* ... JSX ... */ };
        const SettingsPage = ({...}) => { /* ... JSX ... */ };

        // ===== COMPOSANT PRINCIPAL =====
        const MemoireMekong = () => {
            const { currentPage, setCurrentPage, currentUser, setCurrentUser, resetApp } = useAppState();
            const authProps = useGoogleAuth();
            const { sessions, setSessions, createSession, updateSession, deleteSession, syncSessions } = useSessionState(authProps.isConnected);

            // ... (logique de gestion des sessions, etc.)

            return (
                <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-4">
                    <div className="max-w-6xl mx-auto">
                        <Navigation {...} />
                        <div className="bg-white/80 backdrop-blur rounded-xl shadow-lg p-6">
                            {currentPage === 'settings' && <SettingsPage onReset={resetApp} authProps={authProps} />}
                            {/* ... autres pages */}
                        </div>
                    </div>
                </div>
            );
        };

        // ===== RENDER =====
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MemoireMekong />);
        </script>
</body>
</html>
